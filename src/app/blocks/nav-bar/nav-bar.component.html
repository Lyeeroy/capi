<!-- Unified Navigation Bar -->
<header
  class="sticky top-0 z-50 bg-white dark:bg-zinc-900 border-b border-gray-200 dark:border-zinc-700"
>
  <div class="mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Left: Mobile Menu, Logo and Navigation -->
      <div class="flex items-center gap-2 sm:gap-3 lg:gap-8">
        <!-- Mobile Menu Button (far left) -->
        <button
          type="button"
          class="lg:hidden p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-lg transition-colors outline-none focus:ring-2 focus:ring-blue-500"
          (click)="toggleMenu($event)"
          aria-label="Toggle menu"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>

        <!-- Logo -->
        <a
          routerLink="/"
          class="flex items-center outline-none focus:outline-none flex-shrink-0"
          tabindex="-1"
        >
          <img
            src="capi.ico"
            class="w-14 h-7 sm:w-16 sm:h-8 lg:w-18 lg:h-10 rounded-lg dark:grayscale dark:invert"
            alt="Capi Logo"
          />
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:block">
          <ul class="flex items-center gap-1">
            <li *ngFor="let item of filteredMenuItems">
              <a
                routerLink="{{ item.route }}"
                class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors outline-none focus:ring-2 focus:ring-blue-500"
                [ngClass]="{
                  'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950':
                    isActive(item.route),
                  'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800':
                    !isActive(item.route)
                }"
                (click)="handleClick($event)"
              >
                <app-icon-lib
                  ico="{{ item.svg }}"
                  class="w-5 h-5"
                ></app-icon-lib>
                <span>{{ item.label }}</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Right: Search Bar (Desktop) + Action Buttons -->
      <div class="flex items-center gap-2 sm:gap-3">
        <!-- Search Bar (Desktop only) - REDUCED WIDTH -->
        <div class="hidden lg:block w-48 xl:w-64">
          <div class="relative">
            <div
              class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
            >
              <app-icon-lib
                ico="search"
                class="h-5 w-5 text-gray-400"
              ></app-icon-lib>
            </div>
            <input
              id="search"
              type="text"
              placeholder="Search..."
              [(ngModel)]="query"
              (input)="searchMovies()"
              (keydown.enter)="searchMovies()"
              class="block w-full pl-10 pr-10 py-2 bg-gray-100 dark:bg-zinc-800 border-0 rounded-full text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-zinc-700"
            />
            <button
              *ngIf="query.length > 0"
              type="button"
              (click)="clearSearch(); focusSearchInput()"
              class="absolute inset-y-0 right-0 pr-3 flex items-center"
              aria-label="Clear search"
            >
              <app-icon-lib
                ico="clear"
                class="h-5 w-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
              ></app-icon-lib>
            </button>
          </div>
        </div>

        <!-- Sources Button -->
        <button
          class="relative p-2 rounded-lg transition-colors outline-none focus:ring-2 focus:ring-blue-500 flex-shrink-0"
          routerLink="/table"
          aria-label="Sources"
          [ngClass]="{
            'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950':
              isActive('/table'),
            'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800':
              !isActive('/table')
          }"
        >
          <app-icon-lib ico="sources" class="w-6 h-6"></app-icon-lib>
          <span
            *ngIf="sources.length > 0"
            class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 flex items-center justify-center text-xs font-medium text-white bg-blue-600 rounded-full"
          >
            {{ sources.length }}
          </span>
        </button>

        <!-- Settings Button -->
        <button
          class="p-2 rounded-lg transition-all outline-none focus:ring-2 focus:ring-blue-500 group flex-shrink-0"
          routerLink="/settings"
          aria-label="Settings"
          [ngClass]="{
            'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950':
              isActive('/settings'),
            'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800':
              !isActive('/settings')
          }"
        >
          <app-icon-lib
            ico="settings"
            class="w-6 h-6 transition-transform group-hover:rotate-90"
          ></app-icon-lib>
        </button>
      </div>
    </div>

    <!-- Mobile Search Bar -->
    <div class="lg:hidden pb-3">
      <div class="relative">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <app-icon-lib
            ico="search"
            class="h-5 w-5 text-gray-400"
          ></app-icon-lib>
        </div>
        <input
          type="text"
          placeholder="Search..."
          [(ngModel)]="query"
          (input)="searchMovies()"
          (keydown.enter)="searchMovies()"
          class="block w-full pl-10 pr-10 py-2 bg-gray-100 dark:bg-zinc-800 border-0 rounded-full text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button
          *ngIf="query.length > 0"
          type="button"
          (click)="clearSearch(); focusSearchInput()"
          class="absolute inset-y-0 right-0 pr-3 flex items-center"
        >
          <app-icon-lib
            ico="clear"
            class="h-5 w-5 text-gray-400 hover:text-gray-600"
          ></app-icon-lib>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Menu Dropdown -->
<div
  *ngIf="showMobileMenu"
  class="fixed inset-x-0 top-0 z-[60] lg:hidden"
  (clickOutside)="closeMenu()"
>
  <!-- Backdrop -->
  <div
    class="fixed inset-0 bg-black/20 dark:bg-black/40 -z-10"
    (click)="closeMenu()"
  ></div>

  <!-- Menu Panel - positioned below navbar -->
  <div
    class="mt-[64px] bg-white dark:bg-zinc-900 shadow-lg border-b border-gray-200 dark:border-zinc-800"
  >
    <nav class="px-4 py-2 max-w-7xl mx-auto">
      <ul class="space-y-1">
        <li *ngFor="let item of filteredMenuItems">
          <a
            routerLink="{{ item.route }}"
            (click)="handleClick($event); closeMenu()"
            class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors"
            [ngClass]="{
              'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-950':
                isActive(item.route),
              'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800':
                !isActive(item.route)
            }"
          >
            <app-icon-lib ico="{{ item.svg }}" class="w-5 h-5"></app-icon-lib>
            <span>{{ item.label }}</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
