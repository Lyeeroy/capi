<!-- Settings Content Wrapper -->
<div class="w-full max-w-4xl mx-auto mt-16 px-4">
  <!-- General Section -->
  <div id="general" class="mb-12">
    <div
      class="flex items-center justify-between py-4 cursor-pointer group"
      (click)="toggleSection('general')"
    >
      <div>
        <h2 class="text-2xl font-normal text-gray-900 dark:text-gray-100">
          General
        </h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          Basic app features and toggles
        </p>
      </div>
      <div
        class="transition-transform duration-200"
        [class.rotate-180]="isGeneralExpanded"
      >
        <app-icon-lib
          ico="chevronDown"
          class="w-5 h-5 text-gray-500 dark:text-gray-400"
        ></app-icon-lib>
      </div>
    </div>

    <div
      *ngIf="isGeneralExpanded"
      class="border-t border-gray-200 dark:border-zinc-800"
    >
      <!-- Continue Watching -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Continue Watching
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Save your progress and show Continue Watching section on the home
            page
          </div>
        </div>
        <label
          class="relative inline-flex items-center cursor-pointer flex-shrink-0"
        >
          <input
            type="checkbox"
            class="sr-only peer"
            [(ngModel)]="settings.enableContinueWatching"
            (change)="
              onEnableContinueWatchingChange(settings.enableContinueWatching)
            "
          />
          <div
            class="w-12 h-7 bg-gray-300 dark:bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-zinc-900 rounded-full peer peer-checked:bg-blue-600 transition-colors"
          ></div>
          <div
            class="absolute left-0.5 top-0.5 bg-white w-6 h-6 rounded-full shadow-sm transition-transform peer-checked:translate-x-5"
          ></div>
        </label>
      </div>

      <!-- Auto Scroll to Episode -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Auto scroll to episode
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Automatically scroll to the currently playing episode in the
            playlist
          </div>
        </div>
        <label
          class="relative inline-flex items-center cursor-pointer flex-shrink-0"
        >
          <input
            type="checkbox"
            class="sr-only peer"
            [(ngModel)]="settings.enableScrollToEpisode"
            (change)="
              onEnableScrollToEpisodeChange(settings.enableScrollToEpisode)
            "
          />
          <div
            class="w-12 h-7 bg-gray-300 dark:bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-zinc-900 rounded-full peer peer-checked:bg-blue-600 transition-colors"
          ></div>
          <div
            class="absolute left-0.5 top-0.5 bg-white w-6 h-6 rounded-full shadow-sm transition-transform peer-checked:translate-x-5"
          ></div>
        </label>
      </div>

      <!-- Watched Episodes -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Watched episodes tracking
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Track episodes with indicators and mark them as watched
            automatically
          </div>
        </div>
        <label
          class="relative inline-flex items-center cursor-pointer flex-shrink-0"
        >
          <input
            type="checkbox"
            class="sr-only peer"
            [(ngModel)]="settings.enableWatchedEpisodes"
            (change)="
              onEnableWatchedEpisodesChange(settings.enableWatchedEpisodes)
            "
          />
          <div
            class="w-12 h-7 bg-gray-300 dark:bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-zinc-900 rounded-full peer peer-checked:bg-blue-600 transition-colors"
          ></div>
          <div
            class="absolute left-0.5 top-0.5 bg-white w-6 h-6 rounded-full shadow-sm transition-transform peer-checked:translate-x-5"
          ></div>
        </label>
      </div>

      <!-- Watchlist -->
      <div class="py-6 border-b border-gray-100 dark:border-zinc-800">
        <div class="flex items-center justify-between">
          <div class="flex-1 pr-8">
            <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
              Watchlist
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
              Save movies and TV shows to watch later
            </div>
          </div>
          <label
            class="relative inline-flex items-center cursor-pointer flex-shrink-0"
          >
            <input
              type="checkbox"
              class="sr-only peer"
              [(ngModel)]="settings.enableWatchlist"
              (change)="onEnableWatchlistChange(settings.enableWatchlist)"
            />
            <div
              class="w-12 h-7 bg-gray-300 dark:bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2 dark:peer-focus:ring-offset-zinc-900 rounded-full peer peer-checked:bg-blue-600 transition-colors"
            ></div>
            <div
              class="absolute left-0.5 top-0.5 bg-white w-6 h-6 rounded-full shadow-sm transition-transform peer-checked:translate-x-5"
            ></div>
          </label>
        </div>

        <!-- Clear Watchlist (nested) -->
        <div
          *ngIf="settings.enableWatchlist && getWatchlistCount() > 0"
          class="mt-6 pl-0"
        >
          <div class="flex items-center justify-between">
            <div class="flex-1 pr-8">
              <div class="text-sm text-gray-900 dark:text-gray-100">
                Clear watchlist
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                {{ getWatchlistCount() }} item{{
                  getWatchlistCount() === 1 ? "" : "s"
                }}
                saved
              </div>
            </div>
            <button
              (click)="clearWatchlist()"
              class="px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors"
            >
              Clear
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Playlist Section -->
  <div id="playlist" class="mb-12">
    <div
      class="flex items-center justify-between py-4 cursor-pointer group"
      (click)="toggleSection('playlist')"
    >
      <div>
        <h2 class="text-2xl font-normal text-gray-900 dark:text-gray-100">
          Playlist
        </h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          Playlist layout and display options
        </p>
      </div>
      <div
        class="transition-transform duration-200"
        [class.rotate-180]="isPlaylistExpanded"
      >
        <app-icon-lib
          ico="chevronDown"
          class="w-5 h-5 text-gray-500 dark:text-gray-400"
        ></app-icon-lib>
      </div>
    </div>

    <div
      *ngIf="isPlaylistExpanded"
      class="border-t border-gray-200 dark:border-zinc-800"
    >
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Default layout
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Choose how episodes are displayed in the playlist
          </div>
        </div>
        <select
          class="px-3 py-2 text-sm border border-gray-300 dark:border-zinc-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-zinc-900 text-gray-900 dark:text-gray-100 outline-none transition"
          [(ngModel)]="settings.playlistLayout"
          (change)="onPlaylistLayoutChange(settings.playlistLayout)"
        >
          <option value="list">List</option>
          <option value="grid">Grid</option>
          <option value="poster">Poster</option>
          <option value="compact">Compact</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Theme Section -->
  <div id="theme" class="mb-12">
    <div
      class="flex items-center justify-between py-4 cursor-pointer group"
      (click)="toggleSection('theme')"
    >
      <div>
        <h2 class="text-2xl font-normal text-gray-900 dark:text-gray-100">
          Appearance
        </h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          Customize how the app looks
        </p>
      </div>
      <div
        class="transition-transform duration-200"
        [class.rotate-180]="isThemeExpanded"
      >
        <app-icon-lib
          ico="chevronDown"
          class="w-5 h-5 text-gray-500 dark:text-gray-400"
        ></app-icon-lib>
      </div>
    </div>

    <div
      *ngIf="isThemeExpanded"
      class="border-t border-gray-200 dark:border-zinc-800"
    >
      <div class="py-6 border-b border-gray-100 dark:border-zinc-800">
        <div class="flex items-start justify-between">
          <div class="flex-1 pr-8">
            <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
              Theme
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
              Choose light, dark, or automatic based on your system settings
            </div>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-3">
          <label class="flex-1 min-w-[100px] cursor-pointer">
            <input
              type="radio"
              class="peer sr-only"
              name="themeMode"
              value="light"
              [checked]="currentTheme.mode === 'light'"
              (change)="onThemeModeChange('light')"
            />
            <div
              class="px-4 py-3 text-center rounded-lg border-2 transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 border-gray-200 dark:border-zinc-700 hover:border-gray-300 dark:hover:border-zinc-600"
            >
              <div class="text-sm font-medium text-gray-900 dark:text-gray-100">
                Light
              </div>
            </div>
          </label>

          <label class="flex-1 min-w-[100px] cursor-pointer">
            <input
              type="radio"
              class="peer sr-only"
              name="themeMode"
              value="dark"
              [checked]="currentTheme.mode === 'dark'"
              (change)="onThemeModeChange('dark')"
            />
            <div
              class="px-4 py-3 text-center rounded-lg border-2 transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 border-gray-200 dark:border-zinc-700 hover:border-gray-300 dark:hover:border-zinc-600"
            >
              <div class="text-sm font-medium text-gray-900 dark:text-gray-100">
                Dark
              </div>
            </div>
          </label>

          <label class="flex-1 min-w-[100px] cursor-pointer">
            <input
              type="radio"
              class="peer sr-only"
              name="themeMode"
              value="system"
              [checked]="currentTheme.mode === 'system'"
              (change)="onThemeModeChange('system')"
            />
            <div
              class="px-4 py-3 text-center rounded-lg border-2 transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 border-gray-200 dark:border-zinc-700 hover:border-gray-300 dark:hover:border-zinc-600"
            >
              <div class="text-sm font-medium text-gray-900 dark:text-gray-100">
                System
              </div>
            </div>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Privacy & Data Section -->
  <div id="danger" class="mb-12">
    <div
      class="flex items-center justify-between py-4 cursor-pointer group"
      (click)="toggleSection('danger')"
    >
      <div>
        <h2 class="text-2xl font-normal text-gray-900 dark:text-gray-100">
          Privacy & data
        </h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          Manage your local data and storage
        </p>
      </div>
      <div
        class="transition-transform duration-200"
        [class.rotate-180]="isDangerExpanded"
      >
        <app-icon-lib
          ico="chevronDown"
          class="w-5 h-5 text-gray-500 dark:text-gray-400"
        ></app-icon-lib>
      </div>
    </div>

    <div
      *ngIf="isDangerExpanded"
      class="border-t border-gray-200 dark:border-zinc-800"
    >
      <!-- Clear Watched Episodes -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Clear watched episodes
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Reset all watch indicators across all series
          </div>
        </div>
        <button
          (click)="clearAllWatchedEpisodes()"
          class="px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors whitespace-nowrap"
        >
          Clear
        </button>
      </div>

      <!-- Clear Continue Watching -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Clear Continue Watching
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Remove all items from your Continue Watching list
          </div>
        </div>
        <button
          (click)="isUniversalOpenCW = true"
          class="px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors whitespace-nowrap"
        >
          Clear
        </button>
      </div>

      <!-- Clear All Data -->
      <div
        class="py-6 flex items-center justify-between border-b border-gray-100 dark:border-zinc-800"
      >
        <div class="flex-1 pr-8">
          <div class="text-base text-gray-900 dark:text-gray-100 font-medium">
            Clear all data
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Delete all local data including settings, watch history, and sources
          </div>
        </div>
        <button
          (click)="isUniversalOpen = true"
          class="px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors whitespace-nowrap"
        >
          Clear
        </button>
      </div>
    </div>
  </div>

  <!-- Footer spacing -->
  <div class="h-20"></div>
</div>

<!-- Modals -->
<universal-modal
  [open]="isUniversalOpen"
  title="Clear all data?"
  message="This will delete all your local data including settings, watch history, and sources. This action cannot be undone."
  (confirm)="handleUniversalConfirm()"
  (cancel)="isUniversalOpen = false"
></universal-modal>

<universal-modal
  [open]="isUniversalOpenCW"
  title="Clear Continue Watching?"
  message="This will remove all items from your Continue Watching list. This action cannot be undone."
  (confirm)="handleUniversalConfirmCW()"
  (cancel)="isUniversalOpenCW = false"
></universal-modal>

<universal-modal
  [open]="isUniversalOpenWatched"
  title="Clear watched episodes?"
  message="This will reset all watch indicators across all series. This action cannot be undone."
  (confirm)="handleUniversalConfirmWatched()"
  (cancel)="isUniversalOpenWatched = false"
></universal-modal>
