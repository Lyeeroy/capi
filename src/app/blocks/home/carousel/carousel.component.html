<div class="carousel-wrapper">
  <div
    class="carousel-container"
    (mouseenter)="onMouseEnter()"
    (mouseleave)="onMouseLeave()"
  >
    <!-- Slides Track -->
    <div
      class="slides-track"
      [ngStyle]="{
        transform: isDragging
          ? 'translateX(' + (currentTranslateX - currentSlide * 100) + '%)'
          : 'translateX(-' + currentSlide * 100 + '%)'
      }"
      [class.dragging]="isDragging"
      role="region"
      aria-label="Trending Content Carousel"
      (mousedown)="onDragStart($event)"
      (touchstart)="onDragStart($event)"
    >
      <div
        *ngFor="let item of items; let i = index; trackBy: trackByFn"
        class="slide"
        role="group"
        aria-roledescription="slide"
        [attr.aria-label]="
          'Slide ' +
          (i + 1) +
          ' of ' +
          items.length +
          ': ' +
          (item.title || item.name)
        "
      >
        <div class="slide-content">
          <!-- Background Image -->
          <div class="slide-image-container">
            <img
              [src]="'https://image.tmdb.org/t/p/w1280' + item.backdrop_path"
              [alt]="item.title || item.name"
              class="slide-image"
              loading="lazy"
              draggable="false"
            />
          </div>

          <!-- Gradient Overlay -->
          <div class="slide-overlay"></div>

          <!-- Content Container -->
          <div class="slide-info">
            <div class="info-container">
              <!-- Poster Card -->
              <div class="poster-card">
                <img
                  *ngIf="item.poster_path"
                  [src]="'https://image.tmdb.org/t/p/w342' + item.poster_path"
                  [alt]="(item.title || item.name) + ' Poster'"
                  class="poster-image"
                  loading="lazy"
                  draggable="false"
                />
                <div *ngIf="!item.poster_path" class="poster-placeholder">
                  <svg
                    class="placeholder-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                    />
                  </svg>
                </div>
              </div>

              <!-- Text Content -->
              <div class="text-content">
                <h2 class="title">{{ item.title || item.name }}</h2>

                <div class="metadata">
                  <span class="rating" *ngIf="item.vote_average > 0">
                    <svg
                      class="star-icon"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                      />
                    </svg>
                    {{ item.vote_average | number : "1.1-1" }}
                  </span>

                  <span
                    class="separator"
                    *ngIf="
                      item.vote_average > 0 &&
                      (item.release_date || item.first_air_date)
                    "
                    >•</span
                  >

                  <span
                    class="year"
                    *ngIf="item.release_date || item.first_air_date"
                  >
                    {{
                      item.release_date || item.first_air_date | date : "yyyy"
                    }}
                  </span>

                  <span
                    class="separator"
                    *ngIf="
                      item.media_type &&
                      (item.release_date ||
                        item.first_air_date ||
                        item.vote_average > 0)
                    "
                    >•</span
                  >

                  <span *ngIf="item.media_type" class="media-type">
                    {{ item.media_type === "tv" ? "TV" : "Movie" }}
                  </span>
                </div>

                <!-- Action Buttons -->
                <div class="actions">
                  <button
                    [routerLink]="['/player', item.id, item.media_type]"
                    class="btn btn-filled"
                    (click)="$event.stopPropagation()"
                  >
                    <app-icon-lib ico="play" class="btn-icon"></app-icon-lib>
                    <span class="btn-text">Play</span>
                  </button>

                  <app-watchlist-button-old
                    *ngIf="watchlistService.isEnabled()"
                    [tmdbID]="item.id.toString()"
                    [mediaType]="item.media_type"
                    [title]="item.title"
                    [name]="item.name"
                    [poster_path]="item.poster_path"
                    [overview]="item.overview"
                    [release_date]="item.release_date"
                    [first_air_date]="item.first_air_date"
                    [vote_average]="item.vote_average"
                    [genre_ids]="item.genre_ids"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Arrows -->
    <button
      *ngIf="items.length > 1"
      class="nav-arrow nav-prev"
      [class.visible]="isMouseOver"
      (click)="prevSlide()"
      aria-label="Previous slide"
    >
      <svg
        class="nav-icon"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
    </button>

    <button
      *ngIf="items.length > 1"
      class="nav-arrow nav-next"
      [class.visible]="isMouseOver"
      (click)="nextSlide()"
      aria-label="Next slide"
    >
      <svg
        class="nav-icon"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"
        />
      </svg>
    </button>
  </div>

  <!-- Dot Indicators (Outside carousel on mobile, inside on desktop) -->
  <div class="indicators" *ngIf="items.length > 1">
    <button
      *ngFor="let item of items; let i = index"
      class="dot"
      [class.active]="i === currentSlide"
      (click)="goToSlide(i)"
      [attr.aria-label]="'Go to slide ' + (i + 1)"
      [attr.aria-current]="i === currentSlide"
    ></button>
  </div>
</div>
